{% extends 'home/index.html' %}
{% load staticfiles %}
{% load AREXTItemplatetag %}
{% load widget_tweaks %}
{% block styles %}
    <style>
    html, body, #container {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    }
  </style>
{% endblock %}

{% block scripts %}

    <script src="{% static '/js/wordcloud/highcharts.js' %}"></script>
    <script src="{% static '/js/wordcloud/wordcloud.js' %}"></script>
    <script src="{% static '/js/wordcloud/exporting.js' %}"></script>
    <script src="{% static '/js/wordcloud/offline-exporting.js' %}"></script>
    {% block ListadoBaseScripts %}

    {% endblock %}
{% endblock %}


{% block error %}
    {% include 'base/Messages.html' %}
{% endblock %}

{% block principal %}
<!--<Main Content>-->
<section class="content-header">
    <h1>
        {% block icon %}
            <i class="fa fa-mixcloud"></i>
        {% endblock %}
        {% block titulo %}
             Reporte: Nube de palabras
        {% endblock %}
    </h1>
    <h6>
        {% block linkVolver %}
        {% endblock %}
    </h6>
</section>

<section class="content">

    {% block TopBody %}
    {% endblock %}

    <!--<div class="col-md-12">-->
        <!-- Filtros -->
        <div class="row">
            <div class="col-md-12">
                <div class="box-filter">
                    <div class="box-header with-border">
                        <h3 class="box-title">Filtros</h3>
                        <div class="box-tools">
                            <button class="btn btn-box-tool" type="button" data-toggle="collapse"
                                data-target="#collapseFiltros" aria-expanded="true" aria-controls="collapseFiltros">
                                <i class="fa fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="collapse in" id="collapseFiltros">
                        <div class="box-body">
                            {% block filtros %}
                                <form>
                                    <div class="form-row">
                                        <div class="form-group col-md-3">
                                            {{ filterset.form.pericia.label_tag }}
                                            {% render_field filterset.form.pericia class="form-control" %}
                                        </div>
                                        <div class="form-group col-md-3">
                                            {{ filterset.form.tipoImagen.label_tag }}
                                            {% render_field filterset.form.tipoImagen class="form-control" %}
                                        </div>
                                        <div class="form-group col-md-3">
                                            {{ filterset.form.tipoDetalle.label_tag }}
                                            {% render_field filterset.form.tipoDetalle class="form-control" %}
                                        </div>
                                        <div class="form-group col-md-3">
                                            {{ filterset.form.metadato.label_tag }}
                                            {% render_field filterset.form.metadato class="form-control" %}
                                        </div>
                                        <div class="form-group col-md-3">
                                            {{ filterset.form.valormeta.label_tag }}
                                            {% render_field filterset.form.valormeta class="form-control" %}
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <button type="submit" class="btn btn-primary">Generar</button>
                                    </div>
                                </form>
                            {% endblock %}
                            <!--<button type="button" class="btn btn-primary pull-right">Buscar</button>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contenedor Grilla -->
        <div class="row">
            <div class="col-md-12">
                <div class="box">

{#                        <div id="sourrounding_div" style="width:100%;height:500px">#}
{#                            <canvas id="canvas_cloud" width="1707" height="484" lang=""></canvas>#}
{#                        </div>#}
                    {% if nube is None %}
                        <td colspan="11" style="color:darkgrey;text-align:center;"><i class="fa fa-exclamation-circle"></i> <b><small>No se encontraron palabras</small></b></td>
                    {% else %}
                        <div id="sourrounding_div" style="width:100%;height:700px">
                            <div id="container" style="width:100%;height:700px"></div>
                        </div>
                            <script>
                                texto = 'IPP: ' + '{{proyectoipp}} ' + 'Pericia: '+ '{{pericianombre}}';
                                fecha = 'Generado: ' + '{{fecha}}';
                                {#texto = 'subtitulo';#}
                                {#texto = {{pericianombre}};#}
                                {#var texto = ''.concat({{fecha|safe}},'  Pericia: ',{{pericia|safe}},' ',{{pericianombre|safe}});#}
                                {#texto.concat('  Pericia: ');#}
                                data = {{nube|safe}};
                                function random_hsl_color(min, max, cant) {
                                    var i;
                                    var colores = [];
                                    for (i = 0; i < cant; i++) {
                                      colores.push('hsl(' +
                                        (Math.random() * 360).toFixed() + ',' +
                                        (Math.random() * 30 + 70).toFixed() + '%,' +
                                        (Math.random() * (max - min) + min).toFixed() + '%)');
                                    }

                                      return colores;
                                    };
                                Highcharts.setOptions({
                                        lang: {
                                            contextButtonTitle: 'Menu exportar',
                                            downloadCSV: 'Descargar CSV',
                                            downloadPNG: 'Descargar PNG',
                                            downloadJPEG:'Descargar JPEG',
                                            downloadPDF: 'Descargar PDF',
                                            viewFullscreen: 'Ver en pantalla completa',
                                            printChart: 'Imprimir'
                                        }
                                    });
                                Highcharts.chart('container', {
                                    chart: {
                                        {#backgroundColor: '#919191'#}
                                        backgroundColor: '#222d32'
                                        {#,margin: [10, 0, 0, 0]#}
                                    },
                                    exporting: {
                                        chartOptions: { // specific options for the exported image
                                            plotOptions: {
                                                series: {
                                                    dataLabels: {
                                                        enabled: true
                                                    }
                                                }
                                            }
                                        },
                                        filename: 'Nube de palabras ',
                                        fallbackToExportServer: false,
                                        {#menuItemDefinitions: {#}
                                        buttons: {
                                            contextButton: {
                                                menuItems:["viewFullscreen",
                                                "printChart", "separator",
                                                "downloadPNG", "downloadJPEG",
                                                "downloadPDF"],
                                                text: 'Exportar',
                                                {#titleKey: 'Exportar',#}
                                                {#symbol:'menuball',#}
                                        {#        symbolFill: 'gray',#}
                                                height:50,
                                            }
                                        }
                                        {#p}#}
                                    },
                                    series: [{
                                        type: 'wordcloud',
                                        data: data,
                                        name: 'Ocurrencias',
                                        colors: random_hsl_color(60,90,50),
                                        {#colors: random_hsl_color(10,50,50),#}
                                        {#colors: random_hsl_color(10,90,50),#}
                                        {#placementStrategy: 'random',#}
                                        {#spiral: 'archimedean',#}
                                        {#animation: {#}
                                        {#    duration: 10000000000000000000000000000,#}
                                        {#    #}
                                        {#,#}
                                        minFontSize: 6,
                                        maxFontSize: 40,
                                        {#rotation: {#}
                                        {#    from: -45,#}
                                        {#    to: 45,#}
                                        {#    orientations: 8#}
                                        {#P},#}
                                        selected: true
                                    }],
                                    title: {
                                        text: texto,
                                        widthAdjust: -200,
                                        style: {
                                            color: '#d3d3d3',
                                            fontWeight: 'bold',
                                            fontSize: "26px"
                                        }
                                    },
                                    subtitle: {
                                        text: fecha,
                                        style: {
                                            color: '#d3d3d3',
                                            fontWeight: 'bold',
                                            fontSize: "20px",
                                        }
                                    }
                                });
                            </script>
                    {% endif %}
                </div>
            </div>
        </div>
    <!--</div>-->
</section>
<!--</Main Content>-->
{% endblock %}